# 🇯🇵 日本の株価データ取得・分析システム

[GMOアドパートナーズの技術ブログ](https://techblog.gmo-ap.jp/2022/06/07/pythonstockdata/)を参考に作成した、日本の株価データを取得・分析するPythonシステムです。

## 🌐 Webアプリケーション

**📱 オンライン版**: [https://japanese-stock-data-app.streamlit.app/](https://japanese-stock-data-app.streamlit.app/)

ブラウザから直接アクセスして、株価データの取得・分析が可能です。インストール不要で、すぐに利用できます。

## 📋 機能一覧

- **最新株価取得**: stooqとYahoo Financeから最新の株価データを取得
- **株価チャート表示**: 美しいチャートで株価の推移を可視化
- **テクニカル分析**: RSI、MACD、移動平均、ボリンジャーバンドなどの技術指標を計算・表示
- **分析レポート生成**: 詳細な分析レポートを自動生成
- **データソース比較**: stooqとYahoo Financeのデータを比較
- **複数銘柄一括取得**: 複数の銘柄を一度に処理
- **CSV保存**: 取得したデータをCSVファイルに保存
- **🔍 会社名検索**: 150社以上の上場企業を会社名で検索
- **⭐ 主要企業選択**: 人気企業から簡単選択
- **📦 複数銘柄検索**: 会社名検索で複数銘柄を一括選択
- **🏢 ファンダメンタル分析**: 財務指標、企業価値、業界比較の詳細分析
- **⚖️ 財務指標比較**: 複数企業の財務指標を並べて比較分析
- **🔍 高度なデータ分析**: 4つの新しいデータソースを統合した包括的分析
- **📊 感情分析**: ニュース記事の感情スコア分析
- **📋 市場インテリジェンス**: AI生成の投資レポート

## 🚀 セットアップ

### 🌐 Webアプリケーション（推奨）

**インストール不要で、すぐに利用できます！**

📱 **オンライン版**: [https://japanese-stock-data-app.streamlit.app/](https://japanese-stock-data-app.streamlit.app/)

ブラウザから直接アクセスして、以下の機能を利用できます：
- 📊 最新株価取得
- 📈 株価チャート表示
- 🏢 ファンダメンタル分析
- ⚖️ 財務指標比較
- 🔍 会社名検索
- 📦 複数銘柄分析
- 💾 データエクスポート

### 💻 ローカル環境での実行

#### 1. 必要なパッケージのインストール

```bash
pip install -r requirements.txt
```

#### 2. システムの実行

```bash
python main.py
```

#### 3. Webアプリケーションのローカル実行

```bash
streamlit run web_app.py
```

ローカルでWebアプリケーションを実行する場合は、ブラウザで `http://localhost:8501` にアクセスしてください。

## 📊 利用可能なデータソース

### 基本データソース

#### stooq
- **URL**: https://stooq.com/
- **銘柄コード形式**: `4784.JP`
- **特徴**: 無料で利用可能、日本の株価データに特化

#### Yahoo Finance
- **URL**: https://finance.yahoo.com/
- **銘柄コード形式**: `4784.T`
- **特徴**: 世界的に信頼性の高いデータソース
- **注意**: 現在アクセス制限があり、利用できない場合があります

### 高度なデータソース（新機能）

#### Bloomberg API
- **特徴**: 詳細な金融データ・財務指標
- **提供データ**: 時価総額、PER、PBR、配当利回り、ベータ値
- **用途**: 包括的な財務分析

#### Reuters API
- **特徴**: 国際ニュース・市場分析
- **提供データ**: ニュース記事、アナリスト評価、ターゲットプライス
- **用途**: 市場センチメント分析

#### 日本経済新聞
- **特徴**: 国内ニュース・日本市場分析
- **提供データ**: 国内ニュース、日本市場評価、投資家関心度
- **用途**: 日本市場特化分析

#### SEC Filings
- **特徴**: 米国企業開示情報・インサイダー取引
- **提供データ**: 企業開示情報、インサイダー取引データ
- **用途**: 企業情報・コンプライアンス分析

## 🔑 APIキー設定（高度なデータソース用）

高度なデータソースを利用するには、以下のAPIキーが必要です：

### 1. 環境変数での設定（推奨）

```bash
# NewsAPI（ニュース記事取得）
export NEWSAPI_KEY="your_newsapi_key_here"

# Alpha Vantage（市場データ・感情分析）
export ALPHAVANTAGE_KEY="your_alphavantage_key_here"

# Reuters API（国際ニュース）
export REUTERS_KEY="your_reuters_key_here"

# 日経API（日本市場ニュース）
export NIKKEI_KEY="your_nikkei_key_here"

# SEC API（企業開示情報）
export SEC_KEY="your_sec_key_here"
```

### 2. 設定ファイルでの設定

`config.json` ファイルを作成して設定することも可能です：

```json
{
  "advanced_apis": {
    "newsapi": {
      "enabled": true,
      "api_key": "your_newsapi_key_here"
    },
    "alphavantage": {
      "enabled": true,
      "api_key": "your_alphavantage_key_here"
    },
    "reuters": {
      "enabled": true,
      "api_key": "your_reuters_key_here"
    },
    "nikkei": {
      "enabled": true,
      "api_key": "your_nikkei_key_here"
    },
    "sec": {
      "enabled": true,
      "api_key": "your_sec_key_here"
    }
  }
}
```

### 3. APIキーの取得方法

#### NewsAPI
1. [NewsAPI](https://newsapi.org/) にアクセス
2. アカウント登録
3. APIキーを取得（無料プラン：1日1000リクエスト）

#### Alpha Vantage
1. [Alpha Vantage](https://www.alphavantage.co/) にアクセス
2. アカウント登録
3. APIキーを取得（無料プラン：1日500リクエスト）

#### Reuters API
1. [Reuters Developer Portal](https://developers.reuters.com/) にアクセス
2. アカウント登録
3. APIキーを取得（有料）

#### 日経API
1. [日経API](https://api.nikkei.com/) にアクセス
2. アカウント登録
3. APIキーを取得（有料）

#### SEC API
1. [SEC EDGAR](https://www.sec.gov/edgar/sec-api-documentation) にアクセス
2. アカウント登録
3. APIキーを取得（無料）

### 4. 定期的なデータ更新

システムは以下の間隔でデータを自動更新します：
- **ニュースデータ**: 1時間ごと
- **財務データ**: 1日ごと
- **SECデータ**: 1日ごと
- **市場分析データ**: 4時間ごと

APIキーが設定されていない場合、サンプルデータが表示されます。
- **特徴**: 米国企業開示情報・インサイダー取引
- **提供データ**: 企業開示書類、インサイダー取引情報
- **用途**: 企業透明性・内部情報分析

## 🎯 使用例

### 🔍 会社名検索機能

システムは150社以上の日本の主要上場企業のデータベースを内蔵しており、以下の方法で銘柄を選択できます：

1. **銘柄コード直接入力**: 従来通り銘柄コードを直接入力
2. **会社名検索**: 会社名の一部を入力して検索（例: "トヨタ"、"ソニー"、"任天堂"）
3. **主要企業選択**: 人気企業のリストから選択

検索機能は以下の特徴があります：
- **完全一致**: 正確な会社名で検索
- **部分一致**: 会社名の一部で検索
- **類似検索**: 類似度30%以上の会社を表示
- **業種別検索**: 業種で絞り込み検索
- **複数銘柄選択**: 検索結果から複数銘柄を一括選択

### 基本的な使用方法

```python
from stock_data_fetcher import JapaneseStockDataFetcher
from stock_analyzer import StockAnalyzer
from company_search import CompanySearch

# システムの初期化
fetcher = JapaneseStockDataFetcher()
analyzer = StockAnalyzer(fetcher)
company_searcher = CompanySearch()

# 会社名で検索
results = company_searcher.search_by_name("トヨタ")
if results:
    company = results[0]['company']
    ticker = company['code']
    print(f"検索結果: {company['name']} ({ticker})")

# 最新株価を取得
latest_price = fetcher.get_latest_price(ticker, "stooq")
print(f"最新終値: {latest_price['close']}円")

# チャートを表示
analyzer.plot_stock_price(ticker, "stooq", days=30)

# テクニカル分析を実行
analyzer.plot_technical_analysis(ticker, "stooq", days=60)

# 分析レポートを生成
analyzer.generate_report(ticker, "stooq", days=30)
```

### 会社名検索の使用例

```python
from company_search import CompanySearch

searcher = CompanySearch()

# 会社名で検索
results = searcher.search_by_name("ソフトバンク")
for result in results:
    company = result['company']
    print(f"{company['name']} ({company['code']}) - {company['sector']}")

# 業種で検索
tech_companies = searcher.search_by_sector("情報・通信")
for company in tech_companies:
    print(f"{company['name']} ({company['code']})")

# 主要企業を取得
popular = searcher.get_popular_companies(10)
for company in popular:
    print(f"{company['name']} ({company['code']})")
```

### データの取得と保存

```python
# 過去30日間のデータを取得
df = fetcher.fetch_stock_data_stooq("4784", "2024-01-01", "2024-01-31")

# CSVファイルに保存
fetcher.save_to_csv(df, "4784", "stooq")
```

## 📈 対応しているテクニカル指標

- **移動平均**: 5日、20日移動平均
- **RSI (相対力指数)**: 14日間のRSI
- **MACD**: 12日、26日、9日のMACD
- **ボリンジャーバンド**: 20日間の標準偏差±2σ

## 📁 ファイル構成

```
japanese-stock-data-app/
├── main.py                 # メインインターフェース
├── stock_data_fetcher.py   # 株価データ取得クラス
├── stock_analyzer.py       # 分析・可視化クラス
├── company_search.py       # 会社名検索機能
├── company_data.json       # 企業データベース
├── fundamental_analyzer.py # ファンダメンタル分析機能
├── requirements.txt        # 依存関係
├── README.md              # このファイル
└── stock_data/            # データ保存ディレクトリ（自動作成）
    ├── stooq_stock_data_4784.csv
    └── yahoo_stock_data_4784.csv
```

## 🎨 出力されるチャート

### 基本チャート
- 株価の推移（終値、高値、安値）
- 出来高

### テクニカル分析チャート
- 株価と移動平均、ボリンジャーバンド
- RSI（相対力指数）
- MACD
- 出来高

### ファンダメンタル分析チャート
- 財務指標の可視化
- 業界比較グラフ
- 投資判断の根拠

### 財務指標比較チャート
- 複数企業のROE比較
- P/E倍率比較
- 配当利回り比較
- 財務健全性比較

## 📊 サンプル銘柄コード

| 銘柄コード | 会社名 | 業種 |
|-----------|--------|------|
| 4784 | GMOアドパートナーズ | 情報・通信 |
| 7203 | トヨタ自動車 | 自動車 |
| 6758 | ソニーグループ | 電気機器 |
| 9984 | ソフトバンクグループ | 情報・通信 |
| 6861 | キーエンス | 電気機器 |
| 9434 | NTTドコモ | 情報・通信 |

## 🏢 ファンダメンタル分析機能

### 対応企業
現在、以下の6社でファンダメンタル分析が利用可能です：
- **7203** (トヨタ自動車) - 自動車
- **6758** (ソニーグループ) - 電気機器  
- **9984** (ソフトバンクグループ) - 情報・通信
- **6861** (キーエンス) - 電気機器
- **9434** (NTTドコモ) - 情報・通信
- **4784** (GMOアドパートナーズ) - 情報・通信

### 分析項目

#### 📈 収益性分析
- **ROE (自己資本利益率)**: 企業の収益性を測る重要指標
- **ROA (総資産利益率)**: 資産を活用した収益性
- **純利益率**: 売上に対する純利益の割合
- **売上成長率**: 売上高の成長率
- **利益成長率**: 純利益の成長率

#### 💼 企業価値分析
- **P/E (株価収益率)**: 株価の割安・割高を判断
- **P/B (株価純資産倍率)**: 純資産に対する株価の倍率
- **EV/EBITDA**: 企業価値の評価指標
- **配当利回り**: 年間配当金の利回り
- **配当性向**: 純利益に対する配当金の割合
- **フリーキャッシュフロー利回り**: 投資判断の重要指標

#### 🏥 財務健全性
- **流動比率**: 短期債務の支払い能力
- **自己資本比率**: 財務の安定性
- **負債比率**: 財務レバレッジの程度
- **利息カバレッジ比率**: 債務返済能力
- **営業キャッシュフロー**: 事業からの現金流入
- **フリーキャッシュフロー**: 投資後の余剰現金

#### ⚖️ 業界比較
- 同業他社との財務指標比較
- 業界平均との乖離分析
- 投資判断の参考情報

#### 🎯 投資判断
- 総合スコアによる評価
- 買い・売り・ホールドの推奨
- 評価理由の詳細説明

## ⚠️ 注意事項

1. **データの正確性**: このシステムは教育・研究目的で作成されています。投資判断には必ず公式のデータソースを参照してください。

2. **利用制限**: データソースの利用規約を遵守してください。

3. **エラー処理**: ネットワークエラーやデータ取得エラーが発生する可能性があります。

4. **日本語フォント**: チャートの日本語表示には適切なフォントが必要です。macOSではArial Unicode MSが自動的に使用されます。

5. **Yahoo Finance制限**: Yahoo Financeは現在アクセス制限があります。stooqの使用をお勧めします。

6. **ファンダメンタル分析**: 現在は6社のサンプルデータで分析が可能です。実際の投資判断には最新の財務データを参照してください。

7. **財務指標比較**: 比較機能は利用可能な企業間でのみ動作します。

## 🔧 トラブルシューティング

### よくある問題

1. **データが取得できない**
   - 銘柄コードが正しいか確認
   - インターネット接続を確認
   - データソースのサービス状況を確認

2. **チャートが表示されない**
   - matplotlibのバックエンドを確認
   - 日本語フォントの設定を確認

3. **パッケージのインストールエラー**
   - Pythonのバージョンを確認（3.7以上推奨）
   - pipを最新版に更新

## 📚 参考資料

- [GMOアドパートナーズ技術ブログ - Pythonで日本の株価を取得する方法](https://techblog.gmo-ap.jp/2022/06/07/pythonstockdata/)
- [pandas-datareader ドキュメント](https://pandas-datareader.readthedocs.io/)
- [matplotlib ドキュメント](https://matplotlib.org/)

## 📊 実行結果サンプル

### システム起動画面
```
============================================================
🇯🇵 日本の株価データ取得・分析システム 🇯🇵
============================================================
参考: https://techblog.gmo-ap.jp/2022/06/07/pythonstockdata/
============================================================
✅ システムが正常に初期化されました
📊 登録企業数: 150社
🏢 ファンダメンタル分析対応企業数: 27社

📊 利用可能な機能:
1. 最新株価を取得
2. 株価チャートを表示
3. テクニカル分析を実行
4. 分析レポートを生成
5. データソース比較
6. 複数銘柄の一括取得
7. データをCSVに保存
8. ファンダメンタル分析
9. 財務指標比較
0. 終了
```

### ファンダメンタル分析結果例（ソフトバンクグループ）
```
================================================================================
🏢 ソフトバンクグループ (9984) ファンダメンタル分析レポート
================================================================================
📅 分析日: 2025年07月30日
💰 現在株価: 11,560円
🏭 業種: 情報・通信
📊 時価総額: 12.0兆円

📈 収益性分析
   ROE (自己資本利益率): 3.3%
   ROA (総資産利益率): 1.3%
   純利益率: 8.3%
   売上成長率: 5.2%
   利益成長率: 8.1%

💼 企業価値分析
   P/E (株価収益率): 24.0倍
   P/B (株価純資産倍率): 0.8倍
   EV/EBITDA: 29.3倍
   配当利回り: 1.2%
   配当性向: 0.0%
   フリーキャッシュフロー利回り: 3.3%

🏥 財務健全性
   流動比率: 1.8
   自己資本比率: 37.5%
   負債比率: 1.0
   利息カバレッジ比率: 1.4
   営業キャッシュフロー: 0.6兆円
   フリーキャッシュフロー: 0.4兆円

⚖️ 業界比較
   P/E: 企業 24.0倍 vs 業界平均 22.5倍 (差: +6.7%)
   P/B: 企業 0.8倍 vs 業界平均 2.8倍 (差: -71.4%)
   ROE: 企業 3.3% vs 業界平均 15.2% (差: -78.3%)

🎯 投資判断
   総合スコア: 1/8点
   評価理由: 安定成長
   🔴 推奨: 売り
```

### 財務指標比較結果例
```
======================================================================
⚖️ 財務指標比較レポート
======================================================================
📅 比較日: 2025年07月30日

📊 基本情報
──────────────────────────────────────────────────
🏢 ソフトバンクグループ (9984)
   業種: 情報・通信
   時価総額: 12.0兆円

🏢 GMOアドパートナーズ (4784)
   業種: 情報・通信
   時価総額: 1.5兆円

🏢 トヨタ自動車 (7203)
   業種: 自動車
   時価総額: 45.0兆円

📈 ROE比較 (自己資本利益率)
──────────────────────────────────────────────────
   🥇 1位: トヨタ自動車 (7203) - 11.2%
   🥈 2位: GMOアドパートナーズ (4784) - 6.0%
   🥉 3位: ソフトバンクグループ (9984) - 3.3%

💰 P/E比較 (株価収益率)
──────────────────────────────────────────────────
   🥇 1位: GMOアドパートナーズ (4784) - 12.5倍
   🥈 2位: トヨタ自動車 (7203) - 16.1倍
   🥉 3位: ソフトバンクグループ (9984) - 24.0倍

💵 配当利回り比較
──────────────────────────────────────────────────
   🥇 1位: GMOアドパートナーズ (4784) - 2.8%
   🥈 2位: トヨタ自動車 (7203) - 2.1%
   🥉 3位: ソフトバンクグループ (9984) - 1.2%

🏥 財務健全性比較 (負債比率)
──────────────────────────────────────────────────
   🥇 1位: GMOアドパートナーズ (4784) - 0.25
   🥈 2位: トヨタ自動車 (7203) - 0.80
   🥉 3位: ソフトバンクグループ (9984) - 1.00

🎯 総合評価
──────────────────────────────────────────────────
📊 各指標の1位企業:
   ROE: 11.2% (トヨタ自動車)
   P/E: 12.5倍 (GMOアドパートナーズ)
   配当利回り: 2.8% (GMOアドパートナーズ)
   財務健全性: 0.25 (GMOアドパートナーズ)
```

### 会社名検索機能例
```
🔍 会社名で検索
会社名の一部を入力してください（例: トヨタ、ソニー、任天堂）:
検索キーワード: ソフトバンク

📊 検索結果: 7件
--------------------------------------------------------------------------------
 1. ソフトバンクグループ (9984)
    業種: 情報・通信 | 市場: 東証プライム
    マッチ度: 60.0% (部分一致)

 2. ソフトバンクグループ (9984)
    業種: 情報・通信 | 市場: 東証プライム
    マッチ度: 60.0% (部分一致)

 3. ハチバン (9950)
    業種: 小売業 | 市場: 東証プライム
    マッチ度: 40.0% (類似検索)
```

## 📄 ライセンス

このプロジェクトは教育・研究目的で作成されています。商用利用の際は、各データソースの利用規約を確認してください。

## 🤝 貢献

バグ報告や機能改善の提案は歓迎します。プルリクエストも受け付けています。

---

**免責事項**: このシステムで取得したデータは参考情報であり、投資判断の責任は利用者にあります。 