# 🇯🇵 日本の株価データ分析システム

[GMOアドパートナーズの技術ブログ](https://techblog.gmo-ap.jp/2022/06/07/pythonstockdata/)を参考に作成した、日本の株価データを取得・分析するPythonシステムです。

## 🌐 Webアプリケーション

**📱 オンライン版**: [https://japanese-stock-data-app.streamlit.app/](https://japanese-stock-data-app.streamlit.app/)

ブラウザから直接アクセスして、株価データの取得・分析が可能です。インストール不要で、すぐに利用できます。

## 📋 機能一覧

### 🏠 ホーム
- **システム概要**: 登録企業数、ファンダメンタル分析対応企業数、データソース数の表示
- **リアルタイム機能紹介**: WebSocket通信、プッシュ通知、自動更新機能の説明
- **主要企業一覧**: 人気企業の最新株価を美しいカード形式で表示

### 📈 最新株価
- **銘柄コード入力**: 4桁の銘柄コードで株価データを取得
- **データソース選択**: stooq、Yahoo Finance、両方のデータを比較
- **詳細情報表示**: 終値、始値、高値、安値、出来高、日付を表示

### ⚡ リアルタイム監視
- **WebSocket通信**: 即座のデータ更新と双方向通信
- **プッシュ通知**: 重要な価格変動の即座通知
- **自動更新**: 30秒ごとのデータ更新
- **主要銘柄監視**: 9984, 9433, 7203, 6758, 6861のリアルタイム追跡
- **アラート機能**: カスタマイズ可能な閾値での価格変動アラート

### 📊 株価チャート
- **期間選択**: 1週間、1ヶ月、3ヶ月、6ヶ月、1年から選択
- **データソース選択**: stooq、Yahoo Financeから選択
- **ローソク足チャート**: 美しいインタラクティブチャート
- **移動平均線**: 20日移動平均線の表示

### 📈 テクニカル分析チャート
- **チャートタイプ選択**: ローソク足チャート、テクニカル指標チャート
- **技術指標**: 移動平均（MA）、ボリンジャーバンド（BB）、出来高
- **テクニカル指標**: RSI、MACD、ストキャスティクス
- **シグナル分析**: 買い・売り・中立のテクニカル分析シグナル

### 🏢 ファンダメンタル分析
- **財務指標分析**: ROE、ROA、P/E、P/B、配当利回りなど
- **企業価値評価**: 時価総額、EV/EBITDA、フリーキャッシュフロー
- **財務健全性**: 流動比率、自己資本比率、負債比率
- **投資判断**: 総合スコアによる買い・売り・ホールド推奨

### 🎯 高度なファンダメンタル分析
- **ROIC分析**: 投下資本利益率の詳細計算
- **品質指標**: Altman Z-Score、Piotroski F-Score
- **ESGメトリクス**: 環境・社会・ガバナンス指標の評価
- **総合評価**: 複数指標を統合した投資判断

### ⚖️ 財務指標比較
- **複数企業比較**: 最大5社の財務指標を並べて比較
- **業界比較**: 同業他社との財務指標比較
- **ランキング表示**: 各指標の順位付け表示
- **総合評価**: 複数指標を総合した評価

### 📦 複数銘柄分析
- **一括データ取得**: 複数銘柄の株価データを同時取得
- **比較チャート**: 複数銘柄の株価推移を比較表示
- **相関分析**: 銘柄間の相関係数を計算・表示

### 🔍 高度なデータ分析
- **包括的データ分析**: 複数のデータソースを統合した分析
- **感情分析**: ニュース記事の感情スコア分析
- **市場インテリジェンス**: AI生成の投資レポート
- **非同期処理**: 高速なデータ取得処理

### 💾 データエクスポート
- **CSV出力**: 取得したデータをCSVファイルに保存
- **Excel出力**: 分析結果をExcelファイルに出力
- **JSON出力**: データをJSON形式でエクスポート

## 🚀 セットアップ

### 🌐 Webアプリケーション（推奨）

**インストール不要で、すぐに利用できます！**

📱 **オンライン版**: [https://japanese-stock-data-app.streamlit.app/](https://japanese-stock-data-app.streamlit.app/)

ブラウザから直接アクセスして、すべての機能を利用できます。

### 💻 ローカル環境での実行

#### 1. 必要なパッケージのインストール

```bash
pip install -r requirements.txt
```

#### 2. Webアプリケーションのローカル実行

```bash
streamlit run web_app.py
```

ローカルでWebアプリケーションを実行する場合は、ブラウザで `http://localhost:8501` にアクセスしてください。

## 📊 利用可能なデータソース

### 基本データソース

#### stooq
- **URL**: https://stooq.com/
- **銘柄コード形式**: `4784.JP`
- **特徴**: 無料で利用可能、日本の株価データに特化

#### Yahoo Finance
- **URL**: https://finance.yahoo.com/
- **銘柄コード形式**: `4784.T`
- **特徴**: 世界的に信頼性の高いデータソース

### 高度なデータソース

#### Bloomberg API
- **特徴**: 詳細な金融データ・財務指標
- **提供データ**: 時価総額、PER、PBR、配当利回り、ベータ値

#### Reuters API
- **特徴**: 国際ニュース・市場分析
- **提供データ**: ニュース記事、アナリスト評価、ターゲットプライス

#### 日本経済新聞
- **特徴**: 国内ニュース・日本市場分析
- **提供データ**: 国内ニュース、日本市場評価、投資家関心度

#### SEC Filings
- **特徴**: 米国企業開示情報・インサイダー取引
- **提供データ**: 企業開示情報、インサイダー取引データ

## 🎯 使用例

### 基本的な使用方法

```python
from src.core.stock_data_fetcher import JapaneseStockDataFetcher
from src.core.stock_analyzer import StockAnalyzer
from src.core.company_search import CompanySearch

# システムの初期化
fetcher = JapaneseStockDataFetcher()
analyzer = StockAnalyzer(fetcher)
company_searcher = CompanySearch()

# 会社名で検索
results = company_searcher.search_by_name("トヨタ")
if results:
    company = results[0]['company']
    ticker = company['code']
    print(f"検索結果: {company['name']} ({ticker})")

# 最新株価を取得
latest_price = fetcher.get_latest_price(ticker, "stooq")
print(f"最新終値: {latest_price['close']}円")

# チャートを表示
analyzer.plot_stock_price(ticker, "stooq", days=30)

# テクニカル分析を実行
analyzer.plot_technical_analysis(ticker, "stooq", days=60)

# 分析レポートを生成
analyzer.generate_report(ticker, "stooq", days=30)
```

### 会社名検索の使用例

```python
from src.core.company_search import CompanySearch

searcher = CompanySearch()

# 会社名で検索
results = searcher.search_by_name("ソフトバンク")
for result in results:
    company = result['company']
    print(f"{company['name']} ({company['code']}) - {company['sector']}")

# 業種で検索
tech_companies = searcher.search_by_sector("情報・通信")
for company in tech_companies:
    print(f"{company['name']} ({company['code']})")

# 主要企業を取得
popular = searcher.get_popular_companies(10)
for company in popular:
    print(f"{company['name']} ({company['code']})")
```

### データの取得と保存

```python
# 過去30日間のデータを取得
df = fetcher.fetch_stock_data_stooq("4784", "2024-01-01", "2024-01-31")

# CSVファイルに保存
fetcher.save_to_csv(df, "4784", "stooq")
```

## 📈 対応しているテクニカル指標

- **移動平均**: 5日、20日、50日、200日移動平均
- **RSI (相対力指数)**: 14日間のRSI
- **MACD**: 12日、26日、9日のMACD
- **ボリンジャーバンド**: 20日間の標準偏差±2σ
- **ストキャスティクス**: %K、%Dライン

## 📁 ファイル構成

```
japanese-stock-data-app/
├── .devcontainer/             # 開発環境設定
│   └── devcontainer.json
├── .streamlit/                # Streamlit設定
│   └── config.toml
├── config/                    # 設定ファイル
│   ├── config.py
│   └── optimization_config.py
├── docs/                      # ドキュメント
│   ├── advanced_fundamental_analysis_guide.md
│   ├── IMPROVEMENT_PROPOSALS.md
│   ├── IMPROVEMENTS_IMPLEMENTED.md
│   ├── README_WebUI.md
│   └── system_architecture.md
├── src/                       # ソースコード
│   ├── analysis/              # 分析機能
│   │   ├── advanced_data_sources.py
│   │   ├── advanced_fundamental_analyzer.py
│   │   ├── fundamental_analyzer.py
│   │   └── technical_analysis.py
│   ├── core/                  # コア機能
│   │   ├── company_data.json
│   │   ├── company_search.py
│   │   ├── stock_analyzer.py
│   │   └── stock_data_fetcher.py
│   ├── data/                  # データ処理
│   │   ├── async_data_sources.py
│   │   └── real_time_updater.py
│   ├── ml/                    # 機械学習
│   │   ├── ml_predictor.py
│   │   └── portfolio_optimizer.py
│   ├── security/              # セキュリティ
│   │   ├── __init__.py
│   │   └── auth_manager.py
│   ├── utils/                 # ユーティリティ
│   │   ├── __init__.py
│   │   ├── error_handler.py
│   │   └── utils.py
│   └── web/                   # Web関連
│       ├── main.py
│       └── web_app.py
├── tests/                     # テストファイル
│   ├── __init__.py
│   ├── performance_test.py
│   ├── run_all_tests.py
│   ├── test_error_handler.py
│   ├── test_integration.py
│   ├── test_security.py
│   └── test_system.py
├── .gitignore                 # Git除外設定
├── main.py                    # メインエントリーポイント
├── README.md                  # このファイル
├── README_Streamlit.md        # Streamlit専用README
├── requirements.txt           # 依存関係
├── streamlit_app.py          # Streamlit Webアプリ
├── test_advanced_fundamental.py # 高度分析テスト
└── web_app.py                # レガシーWebアプリ
```

## 🎨 出力されるチャート

### 基本チャート
- 株価の推移（終値、高値、安値）
- 出来高

### テクニカル分析チャート
- 株価と移動平均、ボリンジャーバンド
- RSI（相対力指数）
- MACD
- ストキャスティクス
- 出来高

### ファンダメンタル分析チャート
- 財務指標の可視化
- 業界比較グラフ
- 投資判断の根拠

### 財務指標比較チャート
- 複数企業のROE比較
- P/E倍率比較
- 配当利回り比較
- 財務健全性比較

## 📊 サンプル銘柄コード

| 銘柄コード | 会社名 | 業種 |
|-----------|--------|------|
| 4784 | GMOアドパートナーズ | 情報・通信 |
| 7203 | トヨタ自動車 | 自動車 |
| 6758 | ソニーグループ | 電気機器 |
| 9984 | ソフトバンクグループ | 情報・通信 |
| 6861 | キーエンス | 電気機器 |
| 9434 | NTTドコモ | 情報・通信 |

## 🏢 ファンダメンタル分析機能

### 対応企業
現在、以下の6社でファンダメンタル分析が利用可能です：
- **7203** (トヨタ自動車) - 自動車
- **6758** (ソニーグループ) - 電気機器  
- **9984** (ソフトバンクグループ) - 情報・通信
- **6861** (キーエンス) - 電気機器
- **9434** (NTTドコモ) - 情報・通信
- **4784** (GMOアドパートナーズ) - 情報・通信

### 分析項目

#### 📈 収益性分析
- **ROE (自己資本利益率)**: 企業の収益性を測る重要指標
- **ROA (総資産利益率)**: 資産を活用した収益性
- **純利益率**: 売上に対する純利益の割合
- **売上成長率**: 売上高の成長率
- **利益成長率**: 純利益の成長率

#### 💼 企業価値分析
- **P/E (株価収益率)**: 株価の割安・割高を判断
- **P/B (株価純資産倍率)**: 純資産に対する株価の倍率
- **EV/EBITDA**: 企業価値の評価指標
- **配当利回り**: 年間配当金の利回り
- **配当性向**: 純利益に対する配当金の割合
- **フリーキャッシュフロー利回り**: 投資判断の重要指標

#### 🏥 財務健全性
- **流動比率**: 短期債務の支払い能力
- **自己資本比率**: 財務の安定性
- **負債比率**: 財務レバレッジの程度
- **利息カバレッジ比率**: 債務返済能力
- **営業キャッシュフロー**: 事業からの現金流入
- **フリーキャッシュフロー**: 投資後の余剰現金

#### ⚖️ 業界比較
- 同業他社との財務指標比較
- 業界平均との乖離分析
- 投資判断の参考情報

#### 🎯 投資判断
- 総合スコアによる評価
- 買い・売り・ホールドの推奨
- 評価理由の詳細説明

## 🎨 WebUIデザイン

### モダンなデザイン
- **カスタムCSS**: 美しいグラデーション背景とカードデザイン
- **アニメーション**: フェードイン効果とホバーエフェクト
- **レスポンシブデザイン**: デスクトップ、タブレット、モバイル対応
- **統一されたカラーテーマ**: 紫・青のグラデーション

### ユーザビリティ
- **直感的なナビゲーション**: セレクトボックスでの機能選択
- **視覚的フィードバック**: ホバーエフェクトとアニメーション
- **一貫したデザイン**: 全ページで統一されたUI/UX
- **アクセシビリティ**: 適切なコントラストとフォントサイズ

### モダンなデザイン
- **カスタムCSS**: 美しいグラデーション背景とカードデザイン
- **アニメーション**: フェードイン効果とホバーエフェクト
- **レスポンシブデザイン**: デスクトップ、タブレット、モバイル対応
- **統一されたカラーテーマ**: 紫・青のグラデーション

### ユーザビリティ
- **直感的なナビゲーション**: セレクトボックスでの機能選択
- **視覚的フィードバック**: ホバーエフェクトとアニメーション
- **一貫したデザイン**: 全ページで統一されたUI/UX
- **アクセシビリティ**: 適切なコントラストとフォントサイズ

## ⚠️ 注意事項

1. **データの正確性**: このシステムは教育・研究目的で作成されています。投資判断には必ず公式のデータソースを参照してください。

2. **利用制限**: データソースの利用規約を遵守してください。

3. **エラー処理**: ネットワークエラーやデータ取得エラーが発生する可能性があります。

4. **日本語フォント**: チャートの日本語表示には適切なフォントが必要です。

5. **ファンダメンタル分析**: 現在は6社のサンプルデータで分析が可能です。実際の投資判断には最新の財務データを参照してください。

6. **リアルタイム機能**: WebSocketやRedisが必要な機能は、環境によって利用できない場合があります。

## 🔧 トラブルシューティング

### よくある問題

1. **データが取得できない**
   - 銘柄コードが正しいか確認
   - インターネット接続を確認
   - データソースのサービス状況を確認

2. **チャートが表示されない**
   - matplotlibのバックエンドを確認
   - 日本語フォントの設定を確認

3. **パッケージのインストールエラー**
   - Pythonのバージョンを確認（3.7以上推奨）
   - pipを最新版に更新

4. **WebUIが起動しない**
   - Streamlitのバージョンを確認
   - 依存関係の競合を確認

## 📚 参考資料

- [GMOアドパートナーズ技術ブログ - Pythonで日本の株価を取得する方法](https://techblog.gmo-ap.jp/2022/06/07/pythonstockdata/)
- [pandas-datareader ドキュメント](https://pandas-datareader.readthedocs.io/)
- [matplotlib ドキュメント](https://matplotlib.org/)
- [Streamlit ドキュメント](https://docs.streamlit.io/)

## 📊 実行結果サンプル

### WebUI起動画面
```
🇯🇵 日本の株価データ分析システム
📊 リアルタイム株価監視 | 📈 テクニカル分析 | 🏢 ファンダメンタル分析 | ⚡ 高度なデータ分析
```

### ファンダメンタル分析結果例（ソフトバンクグループ）
```
🏢 ソフトバンクグループ (9984) ファンダメンタル分析レポート
📅 分析日: 2025年07月30日
💰 現在株価: 11,560円
🏭 業種: 情報・通信
📊 時価総額: 12.0兆円

📈 収益性分析
   ROE (自己資本利益率): 3.3%
   ROA (総資産利益率): 1.3%
   純利益率: 8.3%
   売上成長率: 5.2%
   利益成長率: 8.1%

💼 企業価値分析
   P/E (株価収益率): 24.0倍
   P/B (株価純資産倍率): 0.8倍
   EV/EBITDA: 29.3倍
   配当利回り: 1.2%
   配当性向: 0.0%
   フリーキャッシュフロー利回り: 3.3%

🏥 財務健全性
   流動比率: 1.8
   自己資本比率: 37.5%
   負債比率: 1.0
   利息カバレッジ比率: 1.4
   営業キャッシュフロー: 0.6兆円
   フリーキャッシュフロー: 0.4兆円

⚖️ 業界比較
   P/E: 企業 24.0倍 vs 業界平均 22.5倍 (差: +6.7%)
   P/B: 企業 0.8倍 vs 業界平均 2.8倍 (差: -71.4%)
   ROE: 企業 3.3% vs 業界平均 15.2% (差: -78.3%)

🎯 投資判断
   総合スコア: 1/8点
   評価理由: 安定成長
   🔴 推奨: 売り
```

## 📄 ライセンス

このプロジェクトは教育・研究目的で作成されています。商用利用の際は、各データソースの利用規約を確認してください。

## 🤝 貢献

バグ報告や機能改善の提案は歓迎します。プルリクエストも受け付けています。

---

**免責事項**: このシステムで取得したデータは参考情報であり、投資判断の責任は利用者にあります。 